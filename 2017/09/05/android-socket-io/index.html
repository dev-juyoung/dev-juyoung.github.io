<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Android Socket.io 라이브러리를 사용해보자. · Cro, Developer</title><meta name="description" content="Android Socket.io 라이브러리를 사용해보자. - Juyoung, Lee"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://dev-juyoung.github.io/atom.xml" title="Cro, Developer"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">HOME</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/dev-juyoung" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><nav><span>CATEGORIES.</span><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Story/">Story</a></li></ul></nav><main class="container"><div class="post"><article class="post-block"><h1 class="post-title"><!--!= formattedTitle-->Android Socket.io 라이브러리를 사용해보자.</h1><div class="post-info">Sep 5, 2017</div><div class="post-content"><p>요즘 많은 어플리케이션을 사용하다보면, 사용자간의 소통을 위한 기능으로 <code>채팅기능</code>을 제공하고 있습니다.<br>실제로 현업에서 개발을 진행하다보면 채팅은 <code>필수기능</code>으로 꼽힐 정도로 사용자의 니즈가 많은 것 같습니다.</p>
<p>최근들어 제가 속해 있는 스타트업에서는, 채팅기능에 대한 사용자의 피드백과 필요성을 많이 느끼고 있음을 알고,<br>개발팀에서는 실제 본격적인 개발에 들어가기에 앞서, 채팅기능에 대한 검토와 프로토타이핑을 진행하고 있습니다.</p>
<p>요즘은 기술이 많이 발전하여 채팅을 구현한다고하면 socket통신 / mqtt / xmpp 등 많은 기술스택을 생각할 수 있지만,<br>저희는 현재 node.js를 이용하여 back-end를 개발해왔으며, npm의 module중 socket통신과 관련된 유명한 module인 <code>socket.io</code>를 이용해서 채팅을 구현해보기로 했습니다.<br>socket.io팀(?)에서는 다행히도 안드로이드에서 쉽게 socket.io를 사용할 수 있도록 라이브러리도 만들어두었습니다.<br><a id="more"></a></p>
<p>우선 본격적인 글을 시작하기에 앞서, <code>글 읽기 귀찮고 난 코드만 알려줘!</code>라고 하시는분들을 위해 참고 URL부터 언급하고 시작하겠습니다.</p>
<h2 id="참고-URL"><a href="#참고-URL" class="headerlink" title="참고 URL"></a>참고 URL</h2><ul>
<li><a href="https://github.com/socketio/socket.io-client-java" target="_blank" rel="external">공식 Android Socket.io Github</a><ul>
<li>Android용 Socket.io 공식 Github.</li>
</ul>
</li>
<li><a href="https://socket.io/blog/native-socket-io-and-android" target="_blank" rel="external">공식 Android Socket.io Blog</a><ul>
<li>Android용 Socket.io 공식 Blog.</li>
</ul>
</li>
<li><a href="https://github.com/dev-juyoung/cro-node-socket-example" target="_blank" rel="external">Socket.io Example - Server Github</a><ul>
<li>express + socket.io를 이용한 서버 프로젝트 샘플코드.</li>
</ul>
</li>
<li><a href="https://github.com/dev-juyoung/cro-android-socket-example" target="_blank" rel="external">Socket.io Example - Android Github</a><ul>
<li>Android + socket.io를 이용한 안드로이드 프로젝트 샘플코드.</li>
</ul>
</li>
<li><a href="https://cro-socket-example.herokuapp.com" target="_blank" rel="external">Socket.io Demo Site</a><ul>
<li>heroku url (demo)</li>
<li>웹에서 2개의 Tab을 열어 실제로 어떻게 동작되는지 확인할 수 있습니다.</li>
</ul>
</li>
</ul>
<h2 id="의존성-추가"><a href="#의존성-추가" class="headerlink" title="의존성 추가"></a>의존성 추가</h2><p>Android에서 라이브러리를 사용하기 위해, 제일 먼저 하는 작업은 역시나, gradle에 의존성을 추가해주는 일입니다.<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">compile</span> (<span class="string">'io.socket:socket.io-client:1.0.0'</span>) &#123;</div><div class="line">  <span class="keyword">exclude</span> <span class="keyword">group</span>: <span class="string">'org.json'</span>, module: <span class="string">'json'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>의존성을 추가할 때, <code>exclude group: &#39;org.json&#39;, module: &#39;json&#39;</code>를 해주지 않아도 사용에 문제는 없지만,<br>Android Studio의 로그창에 옛날 버전의 json 패키지를 제외처리했다는 warning 메시지를 볼 수 있으니, 추가하는 것이 좋습니다.</p>
<h2 id="Socket-연결"><a href="#Socket-연결" class="headerlink" title="Socket 연결"></a>Socket 연결</h2><p>Socket 통신을 사용할 Activity에서 다음과 같은 코드를 추가합니다.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> Socket mSocket;</div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">  <span class="comment">// 설명의 편의를 위해 onCreate()메서드에 추가하였으나,</span></div><div class="line">  <span class="comment">// 꼭 onCreate() 메서드에 위치할 필요는 없을 것 같습니다.</span></div><div class="line">  <span class="keyword">try</span> &#123;</div><div class="line">    mSocket = IO.socket(<span class="string">"SERVER URL"</span>);</div><div class="line">    mSocket.connect();</div><div class="line">  &#125; <span class="keyword">catch</span>(URISyntaxException e) &#123;</div><div class="line">    e.printStackTrace();</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>연결을 위한 코드는 단 2줄이면 가능합니다.<br><code>IO.socket(&quot;SERVER URL&quot;)</code>를 이용하면 <code>Socket</code>객체를 얻을 수 있습니다.<br>이렇게 얻은 Socket객체를 통해 이벤트를 서버로 전송하거나 또는 서버로부터 이벤트를 전송받기 위해 계속적으로 들고 있어야하므로,<br>해당 Activity Class 상단에서 <code>mSocket</code> 변수를 선언하고, 해당 변수에 Socket객체를 저장해두시면 됩니다.</p>
<h2 id="Event-전달-처리"><a href="#Event-전달-처리" class="headerlink" title="Event 전달 처리"></a>Event 전달 처리</h2><p>Socket서버에 성공적으로 연결이 되면, 우리는 앞에서 얻은 Socket객체를 통해 이벤트를 서버로 전송하고,<br>서버로부터 전달받은 이벤트를 이용하여 여러가지 처리를 할 수 있습니다.</p>
<p>복잡하게 느껴질 수 있겠지만, 단 2가지만 기억하시면 됩니다.</p>
<ol>
<li>Socket.on(String event, Listener listener)<ul>
<li>첫번째 인자로 <code>서버로부터 전달을 기다리는 이벤트명</code>을 지정하고, </li>
<li>두번째 인자로 해당 이벤트를 전달받은 후, <code>해당 Listener를 통해 Android에서 제어</code>를 하면 됩니다.</li>
</ul>
</li>
<li>Socket.emit(String event, Object args)<ul>
<li>첫번째 인자로 <code>서버로 전송할 이벤트명</code>을 지정하고,</li>
<li>두번째 인자로 추가적으로 전송할 데이터를 지정합니다. 대부분의 서버 - 클라이언트 통신은 <code>JSON</code>을 이용한 통신을 할 것이므로, JSONObject로 데이터를 생성한 후, 지정해주면 될 것 같습니다.</li>
</ul>
</li>
</ol>
<p>약간은 어렵게 느껴지실 수 있지만, 코드를 보면 바로 이해 될 듯 합니다.<br>우선은 서버로부터 전달받은 이벤트를 Android에서 처리하는 코드의 일부입니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">  <span class="comment">// IO.socet()메서드와 mSocket.connect() 메서드사이에 일반적으로 작성하는 것 같습니다.</span></div><div class="line">  mSocket.on(Socket.EVENT_CONNECT, onConnect);</div><div class="line">  mSocket.on(<span class="string">"chat-message"</span>, onMessageReceived);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// Socket서버에 connect 된 후, 서버로부터 전달받은 'Socket.EVENT_CONNECT' Event 처리.</span></div><div class="line"><span class="keyword">private</span> Emitter.Listener onConnect = <span class="keyword">new</span> Emitter.Listener() &#123;</div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(Object... args)</span> </span>&#123;</div><div class="line">    <span class="comment">// your code...</span></div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// 서버로부터 전달받은 'chat-message' Event 처리.</span></div><div class="line"><span class="keyword">private</span> Emitter.Listener onMessageReceived = <span class="keyword">new</span> Emitter.Listener() &#123;</div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(Object... args)</span> </span>&#123;</div><div class="line">    <span class="comment">// 전달받은 데이터는 아래와 같이 추출할 수 있습니다.</span></div><div class="line">    JSONObject receivedData = (JSONObject) args[<span class="number">0</span>];</div><div class="line">    <span class="comment">// your code...</span></div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>생각보다 간단하지 않나요?<br>Android에서 서버로 이벤트를 전달하는 부분은 더 간결합니다. 코드로 확인해보시죠.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 서버로 이벤트를 전송하는 부분에 적절히 추가하시면 될 것 같아요.</span></div><div class="line">JSONObject data = <span class="keyword">new</span> JSONObject();</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">  data.put(<span class="string">"key1"</span>, <span class="string">"value1"</span>);</div><div class="line">  data.put(<span class="string">"key2"</span>, <span class="string">"value2"</span>);</div><div class="line">  mSocket.emit(<span class="string">'event-name'</span>, data);</div><div class="line">&#125; <span class="keyword">catch</span>(JSONException e) &#123;</div><div class="line">  e.printStackTrace();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Java에서 기본적으로 제공되는 JSONObject를 이용하여 데이터를 처리하기 위해서는 <code>JSONException</code>이 발생할 수 있으므로,<br>필수적으로 <code>try - catch</code>처리를 해주어야 합니다. 예외처리를 좋은 습관이라고 생각하지만,<br>이것마저 귀찮으시다면 JSONObject객체에서 제공하는 <code>optXXX()</code> 메서드를 이용하여 처리해 줄 수도 있습니다.</p>
<h2 id="마무리"><a href="#마무리" class="headerlink" title="마무리"></a>마무리</h2><p>저도 실질적으로 프로토타이핑을 해보기 이전에는 Socket통신에 대해 막연한 생각이 있었습니다.<br>하지만 위에서 살펴보았듯, Socket.io 팀에서는 마치 안드로이드에서 사용할 것을 대비하여 Android용 Socket.io 라이브러리를 만들어주었고,<br>Socket 통신을 한번도 안해본 사람도 단 몇줄의 코드를 이용하여 Socket통신을 할 수 있도록 제공하고 있습니다.<br>생활코딩의 <code>이고잉</code>님의 몇몇 강좌에서 하시는 말씀인 <code>프로그래밍하기 좋은 시대에 살고있다.</code>라는 말을 요즘들어 더욱 체감하고 있는 것 같습니다.</p>
<p>위의 코드는 단순히 서버와 클라이언트간의 일회성 Socket통신을 하고 있지만,<br>적절한 이벤트 수/발신 타이밍에 DB나 Push 기능 등을 보강하면 그럴싸한 채팅프로그램을 만들 수 있을 것 같습니다.<br>기회가 된다면, DB나 Push 기능을 조금 더 보강한 그럴싸한 채팅프로그램으로 업데이트를 한 후, 공개하도록 하겠습니다!</p>
</div></article></div></main><footer><!--include mixins/paginator--><!--+post()--><div id="disqus_thread"></div><script>var disqus_shortname = 'dev-juyoung';
var disqus_identifier = '2017/09/05/android-socket-io/';
var disqus_title = 'Android Socket.io 라이브러리를 사용해보자.';
var disqus_url = 'https://dev-juyoung.github.io/2017/09/05/android-socket-io/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//dev-juyoung.disqus.com/count.js" async></script><div class="copyright"><p>© 2016 - 2017 <a href="https://dev-juyoung.github.io">Juyoung, Lee</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-81931719-1",'auto');ga('send','pageview');</script></body></html>